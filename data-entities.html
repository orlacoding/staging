<html>
<head>
	<meta charset="utf-8">
	<title>Seneca, a Micro-Services toolkit for Node.js</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="description" content="">
	<meta name="author" content="">

	<link  rel="stylesheet" href="/staging/styles/bootstrap.css" />
	<link  rel="stylesheet" href="/staging/styles/font-awesome/css/font-awesome.css" />
	<link  rel="stylesheet" href="/staging/styles/style.css" />
	<link  rel="stylesheet" href="/staging/styles/flexslider.css" />

	<link  rel="stylesheet" href="/staging/styles/github.css" />

	<!-- GOOGLE WEB FONTS -->
	<link href='http://fonts.googleapis.com/css?family=Bitter:400,700,400italic' rel='stylesheet' type='text/css'>
	<link href='http://fonts.googleapis.com/css?family=Open+Sans:400,600,700,800' rel='stylesheet' type='text/css'>

	<!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
	<!--[if lt IE 9]>
	<script src="scripts/html5shiv.js"></script>
	<![endif]-->

	<!-- Fav and touch icons -->
	<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/images/apple-touch-icon-144-precomposed.png">
	<link rel="apple-touch-icon-precomposed" sizes="114x114" href="/images/apple-touch-icon-114-precomposed.png">
	<link rel="apple-touch-icon-precomposed" sizes="72x72" href="/images/apple-touch-icon-72-precomposed.png">
	<link rel="apple-touch-icon-precomposed" href="/images/apple-touch-icon-57-precomposed.png">
	<link rel="shortcut icon" href="/images/favicon.png">

	<script defer="defer"  src="/staging/vendor/jquery.js"></script><script defer="defer"  src="/staging/vendor/bootstrap.js"></script>
	<script defer="defer"  src="/staging/scripts/menu.js"></script>

</head>
<body>
<nav class="navbar navbar-default navbar-fixed-top" role="navigation">

	<div class="navbar-960">

		<!-- START TOP NAVBAR -->


		<div class="navbar-header">
			<button class="navbar-toggle" type="button" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1"> <span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button> <a class="navbar-brand" href="index.html">Seneca</a>
		</div>

		<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
			<ul class="nav navbar-nav top-nav">

				<input type="hidden" class="selected-menu-item" value="documentation" />

				<li id="index">
					<a href="index.html"><i class="fa fa-home"></i></a>
				</li>
				<li id="getting-started">
					<a href="getting-started.html" onload="">Get Started</a>
				</li>
				<li id="documentation">
					<a href="documentation.html">Documentation</a>
				</li>
				<!--<li class="dropdown">
					<a class="dropdown-toggle" href="#" data-toggle="dropdown">Dropdowns<strong class="caret"></strong></a>
					<ul class="dropdown-menu">
						<li>
							<a href="index.html">Home Page</a>
						</li>
						<li>
							<a href="content.html">Content Page</a>
						</li>
						<li>
							<a href="content-leftmenu.html">Content Page - Left Sub Menu</a>
						</li>
						<li class="divider">
						</li>
						<li>
							<a href="content.html">Content Page</a>
						</li>
						<li class="divider">
						</li>
						<li>
							<a href="content-leftmenu.html">Content Page - Left Sub Menu</a>
						</li>
					</ul>
				</li>-->
			</ul>

			<ul class="nav navbar-nav navbar-right">
				<li class="dropdown">
					<a class="dropdown-toggle" href="#" data-toggle="dropdown"><i class="fa fa-life-ring"></i> Support<strong class="caret"></strong></a>
					<ul class="dropdown-menu">
						<li>
							<a href="https://github.com/rjrodger/seneca">Source Code (GitHub)</a>
						</li>
						<li>
							<a href="https://github.com/rjrodger/seneca/issues">Bugs! Defects! Breakage!</a>
						</li>
						<li>
							<a href="https://groups.google.com/forum/#!forum/seneca-micro-services">Google Group</a>
						</li>
						<li class="divider">
						</li>
						<li>
							<a href="https://twitter.com/senecajs">@senecajs</a>
						</li>
					</ul>
				</li>
			</ul>
		</div>

	</div>

</nav>


<!-- END TOP NAVBAR -->

<div class="fullwidthtop-content">
  <div class="col-md-12 column">

    <div class="header-box">
      <h1>Seneca Data Entities</h1>
    </div>

  </div>
</div>


<!-- CONTAINER STARTS HERE -->


<div class="container">




  <div class="row clearfix">
    <div class="col-md-12 column">

      <br>

      <p>
        The Seneca framework provides a data entity API based loosely on the
        <a href="http://www.martinfowler.com/eaaCatalog/activeRecord.html" target="_blank">ActiveRecord style</a>.
        Here's how it works.
      </p>

      <br>

      <p>
        <b>
          The Seneca Philosophy
        </b>
      </p>

      <p>
        The Seneca framework is defined by a philosophy that
        <a href="http://www.richardrodger.com/" target="_blank"> actions are better than objects</a>.
      </p>

      <p>
        The only first-class citizens in the Seneca framework are <i>actions</i>. You register actions in Seneca by
        defining a set of key-value pairs that the action matches. When a JSON document is submitted to Seneca,
        it triggers an action if a matching set of key-value pairs is found. The action returns another JSON document.
      </p>

      <p>
        Actions can call other actions, and wrap existing actions. Groups of actions can work together to provide
        specific functionality, such as user management. Such groups are called <i>plugins</i>. To keep things organized,
        a few conventions are used. A <i>role</i> property identifies a specific area of functionality. A <i>cmd</i> property
        identifies a specific action.
      </p>

      <p>
        For example:
      </p>

      
        <pre class="highlight"><code class="hljs javascript">
seneca.act( {role:<span class="hljs-string">'entity'</span>, cmd:<span class="hljs-string">'save'</span>, ent:{...}},
            <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(err,result)</span></span>{ ... } )
        </code></pre>
      

      <p>
        This action will save data entities to persistent storage, as part of the group of actions that perform the
        <i>role</i> of data persistence. The <i>ent</i> property is an object containing the data of the data entity to save.
      </p>

      <p>
        In Seneca, data persistence is provided by a set of actions. These are:
        <code>save</code>, <code>load</code>, <code>list</code>, <code>remove</code>. This provides a consistent interface for all other actions that need to persist data.
      </p>

      <p>
        As convenience, these data entity actions are also available in the form of data entity objects, that expose the <i>cmd</i>s as methods - just like the ActiveRecord pattern.
        However, you cannot add business logic to these objects. <i>Business logic belongs inside actions</i>.
      </p>

      <br>

      <p>
        <b>
          The Data Entity API
        </b>
      </p>
      <p>
        First you need a Seneca instance:
      </p>

      
        <pre class="highlight"><code class="hljs javascript"><span class="hljs-keyword">var</span> seneca = <span class="hljs-built_in">require</span>(<span class="hljs-string">'seneca'</span>)()</code></pre>
      

      <p>Then you can create data entity objects:</p>

      
        <pre class="highlight"><code class="hljs javascript"><span class="hljs-keyword">var</span> foo = seneca.make(<span class="hljs-string">'foo'</span>)</code></pre>
      

      <p>
        The entity name is <i>foo</i>. If your underlying data store is
        MongoDB, this data entity corresponds to the <i>foo</i>
        collection. As a convenience, so you don't have to hook up a database, Seneca provides a transient in-memory store out of the
        box (so you can just start coding!).
      </p>

      <p>
        Next, add some data fields:
      </p>

      
        <pre class="highlight"><code class="hljs javascript">
foo.name = <span class="hljs-string">'Apple'</span>
foo.price = <span class="hljs-number">1.99</span>
        </code></pre>
      

      <p>The data fields are just ordinary JavaScript object properties.</p>

      <p>Now, you need to save the data:</p>


      
        <pre class="highlight"><code class="hljs javascript">
foo.save$(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(err,foo)</span></span>{
  <span class="hljs-built_in">console</span>.log(foo)
})
        </code></pre>
      

      <p>
        The <code>save$</code> method invokes the <i>role:entity, cmd:save</i>
        action, passing in the foo object as the value of <i>ent</i> argument.
      </p>

      <p>
        The reason for the $ suffix is to namespace the <i>cmd</i>
        methods. You can always be 100% certain that vanilla property names
        "just work". Stick to alphanumeric characters and underscore and you'll be fine.
      </p>

      <p>
        The <code>save$</code> method takes a callback, using the standard
        Node.js idiom: The first parameter is an error object (if there was an
        error), the second the result of the action. The <code>save$</code> method provides
        a new copy of the foo entity. This copy has been saved to persistent
        storage, and includes a unique <i>id</i> property.
      </p>

      <p>
        Once you've saved the data entity, you'll want to load it again at
        some point. Use the <code>load$</code> method to do this, passing in
        the <i>id</i> property.
      </p>


      
        <pre class="highlight"><code class="hljs javascript">
<span class="hljs-keyword">var</span> id = <span class="hljs-string">'...'</span>
<span class="hljs-keyword">var</span> foo_entity = seneca.make(<span class="hljs-string">'foo'</span>)
foo_entity.load$( id, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(err,foo)</span></span>{
  <span class="hljs-built_in">console</span>.log(foo)
})
        </code></pre>
      


      <p>
        You can call the <code>load$</code> method on any data entity object
        to load another entity of the same type. The original entity does
        not change - you get the loaded entity back via the callback.
      </p>
      <p>
        To delete entities, you also use the <i>id</i> property, with the
        <code>remove$</code> method:
      </p>


      
        <pre class="highlight"><code class="hljs javascript">
<span class="hljs-keyword">var</span> id = <span class="hljs-string">'...'</span>
<span class="hljs-keyword">var</span> foo_entity = seneca.make(<span class="hljs-string">'foo'</span>)
foo_entity.remove$( id, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(err)</span></span>{ ... })
        </code></pre>
      


      <p>
        To get a list of entities that match a query, use
        the <code>list$</code> method:
      </p>

      
        <pre class="highlight"><code class="hljs javascript">
<span class="hljs-keyword">var</span> foo_entity = seneca.make(<span class="hljs-string">'foo'</span>)
foo_entity.list$( {price:<span class="hljs-number">1.99</span>}, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(err,list)</span></span>{
  list.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( foo )</span></span>{
    <span class="hljs-built_in">console</span>.log(foo)
  })
})
        </code></pre>
      


      <p>
        The matching entities are returned as an array. The query is a set of
        property values, all of which must match.  This is equivalent to a SQL
        query of the form: <code> col1 = 'val1' AND col2 = 'val2' AND ... </code>.
        Seneca provides a common query format that works
        across all data stores. The trade-off is that these queries have
        limited expressiveness (more on this later, including the get-out-of-jail options).
      </p>

      <p>
        One thing you can do is sort the results:
      </p>


      
        <pre class="highlight"><code class="hljs javascript">
foo_entity.list$( {price:<span class="hljs-number">1.99</span>, sort$:{price:-<span class="hljs-number">1</span>}}, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(err,list)</span></span>{
  ...
})
        </code></pre>
      


      <p>
        The <code>sort$</code> meta argument takes a sub-object containing a single key, the field to sort. The value <code>+1</code> means sort ascending,
        and the value <code>-1</code> means sort descending. The common query format only accepts a sort by one field.
      </p>

      <p>
        You can also use queries with the <code>load$</code> and <code>remove$</code> methods. The first matching entity is selected.
      </p>

      <br>

      <p>
        <b>
          Zone, Base and Name: The Entity Namespace
        </b>
      </p>

      <p>
        Your data can live in many different places. It can be persistent or transient. It may have business rules that apply to it.
        It may be owned by different people.
      </p>

      <p>
        Seneca lets you work with your data, without worrying about where it
        lives, or what rules should apply to it. This makes it easy to handle
        different types of data in different ways. To make this easier, Seneca provides a three layer namespace for data entities:
      </p>

      <ul>
        <li><i>name</i>: the primary name of the entity. For example: <i>product</i></li>
        <li><i>base</i>: group name for entities that "belong together". For example: <i>shop</i></li>
        <li><i>zone</i>: name for a data set belonging to a business entity, geography, or customer. For example: <i>tenant001</i></li>
      </ul>

      <p>
        The zone and base are optional. You can just use the name element in the same way you use ordinary database tables, and you'll be just fine.
        Here's an example of creating a <i>foo</i> entity (as seen above):
      </p>

      
        <pre class="highlight"><code class="hljs javascript"><span class="hljs-keyword">var</span> foo_entity = seneca.make(<span class="hljs-string">'foo'</span>)</code></pre>
      


      <p>
        Often, a set of plugins that provide the related functions, will use
        the same <i>base</i>. This ensures that the entities used by these
        plugins won't interfere with your own entities.
      </p>

      <p>
        For example, the <a href="https://github.com/rjrodger/seneca-user" target="_blank">user</a>
        and <a href="https://github.com/rjrodger/seneca-auth" target="_blank">auth</a> plugins,
        which handle user accounts, and login/logout, use the <i>sys</i> base,
        and work with the following entities:
      </p>


      
        <pre class="highlight"><code class="hljs javascript">
<span class="hljs-keyword">var</span> sys_user  = seneca.make(<span class="hljs-string">'sys'</span>,<span class="hljs-string">'user'</span>)
<span class="hljs-keyword">var</span> sys_login = seneca.make(<span class="hljs-string">'sys'</span>,<span class="hljs-string">'login'</span>)
        </code></pre>
      


      <p>
        The underlying database needs to have a name for the table or
        collection associated with an entity. The convention is to join the
        base and name with an underscore, as <code>'_'</code> is accepted by most database
        systems as a valid name character.  This means that <i>name</i>, <i>base</i> and
        <i>zone</i> values should only be alphanumeric, and to be completely safe,
        should never start with a number.
      </p>

      <p>
        For the above plugins, the table or collection names would be:
        <code>sys_user</code> and <code>sys_login</code>.
      </p>

      <p>
        The <i>zone</i> element provides a higher level namespace that Seneca itself does not
        use. It is merely a placeholder for your own needs.  For example, you
        may need to isolate customer data into separate physical databases.
      </p>

      <p>
        The zone is never part of the database table name. You use it by
        registering multiple instances of the same database plugin, pointing
        at different physical databases. Seneca's pattern matching makes this
        automatic for you (see the entity type mapping examples below).
      </p>

      <p>
        You can also use the zone for custom business rules. The zone, base and name appear as action arguments - just pattern match the underlying actions! (and there are examples below).
      </p>

      <br>

      <h5>Creating an Entity with a Specific Zone, Base and Name</h5>

      <p>
        The <i>make</i> method is available on both the main Seneca object, and on each entity object (where it always has a $ suffix):
      </p>

      
        <pre class="highlight"><code class="hljs javascript">
<span class="hljs-comment">// the alias make$ will also work</span>
<span class="hljs-keyword">var</span> foo = seneca.make(<span class="hljs-string">'foo'</span>)

<span class="hljs-comment">// make() does not exist to avoid property clashes</span>
<span class="hljs-keyword">var</span> bar = foo.make$(<span class="hljs-string">'bar'</span>)
        </code></pre>
      


      <p>
        It optionally accepts up to three string arguments, specifying the zone, base and name, always in that order:
      </p>

      
        <pre class="highlight"><code class="hljs javascript">
<span class="hljs-keyword">var</span> foo = seneca.make(<span class="hljs-string">'foo'</span>)
<span class="hljs-keyword">var</span> bar_foo = seneca.make(<span class="hljs-string">'bar'</span>,<span class="hljs-string">'foo'</span>)
<span class="hljs-keyword">var</span> zen_bar_foo = seneca.make(<span class="hljs-string">'zen'</span>,<span class="hljs-string">'bar'</span>,<span class="hljs-string">'foo'</span>)
        </code></pre>
      


      <p>
        When no arguments are given, calling <code>make$</code> on an entity will create a new instance of the same kind (same zone, base and name):
      </p>


      
        <pre class="highlight"><code class="hljs javascript">
<span class="hljs-keyword">var</span> foo = seneca.make(<span class="hljs-string">'foo'</span>)
<span class="hljs-keyword">var</span> morefoo = foo.make$()
        </code></pre>
      


      <p>
        No data is copied, you get a completely new, empty, data entity (use <code>clone$</code> instead to copy the data).
        If you pass in an object as the last argument to <code>make$</code>, it will be used to initialize the entity data fields:
      </p>


      
        <pre class="highlight"><code class="hljs javascript">
<span class="hljs-keyword">var</span> foo = seneca.make(<span class="hljs-string">'foo'</span>, {price:<span class="hljs-number">1.99</span>,color:<span class="hljs-string">'red'</span>})
<span class="hljs-built_in">console</span>.log(<span class="hljs-string">'price is '</span>+foo.price+<span class="hljs-string">' and color is '</span>+foo.color)
        </code></pre>
      


      <p>
        If you call the <code>toString</code> method on an entity, it will indicate the zone, base and name using the syntax <i>zone/base/name</i> as a prefix to the entity data:
      </p>

      
        <pre class="highlight"><code class="hljs javascript">$zone/base/name:{id=...;prop=val,...}</code></pre>
      

      <p>
        If any of the namespace elements are not defined, a minus <code>'-'</code> is used as placeholder:
      </p>


      
        <pre class="highlight"><code class="hljs javascript">$-<span class="hljs-regexp">/-/</span>name:{id=...;prop=val,...}</code></pre>
      

      <p>
        The syntax <i>zone/base/name</i> is also used a shorthand for an
        entity type pattern. For example, <i>-/bar/-</i> means any entities
        that have base <i>bar</i>.
      </p>

      <br>

      <p>
        <b>
          Using Databases to Store Entity Data
        </b>
      </p>

      <p>
        To store persistent data, you'll need to use an external
        database. Each database needs a plugin that understands how to talk to
        that database. The plugins normally use a specific driver module to do the actual talking.
      </p>

      <p>
        For example, the <a href="https://github.com/rjrodger/seneca-mongo-store" target="_blank">seneca-mongo-driver</a> plugin
        uses the <a href="http://mongodb.github.io/node-mongodb-native/" target="_blank">mongodb</a> module.
      </p>

      <p>
        Using a data store plugin is easy. Register with Seneca and supply the database connection details as options to the plugin:
      </p>

      
        <pre class="highlight"><code class="hljs javascript">
<span class="hljs-keyword">var</span> seneca = <span class="hljs-built_in">require</span>(<span class="hljs-string">'seneca'</span>)()
seneca.use(<span class="hljs-string">'mongo-store'</span>,{
  name:<span class="hljs-string">'dbname'</span>,
  host:<span class="hljs-string">'127.0.0.1'</span>,
  port:<span class="hljs-number">27017</span>
})
        </code></pre>
      


      <p>
        The database connection will need to be established before you can
        save data. Use the <code>seneca.ready</code> function to supply a
        callback that will be called once the database is good to go:
      </p>

      
        <pre class="highlight"><code class="hljs javascript">
seneca.ready(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(err)</span></span>{
<span class="hljs-keyword">var</span> apple = seneca.make$(<span class="hljs-string">'fruit'</span>)
apple.name  = <span class="hljs-string">'Pink Lady'</span>
apple.price = <span class="hljs-number">1.99</span>
apple.save$(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(err,apple)</span></span>{
  <span class="hljs-keyword">if</span>( err ) <span class="hljs-keyword">return</span> <span class="hljs-built_in">console</span>.log(err);
    <span class="hljs-built_in">console</span>.log( <span class="hljs-string">"apple = "</span>+apple  )
  })
})
        </code></pre>
      

      <p>
        The <code>seneca.ready</code> function works for any plugin that has a callback dependency
        like this - it will only be triggered once all the plugins are ready.
      </p>

      <p>
        To close any open database connections, use the <code>seneca.close</code> method:
      </p>

      
        <pre class="highlight"><code class="hljs javascript">
seneca.close(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(err)</span></span>{
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'database closed!'</span>)
})
        </code></pre>
      

      <h5>Data Store Plugins</h5>

      <p>
        To use a data store plugin, you'll normally need to install the module via npm:
      </p>

      
        <pre class="highlight"><code class="hljs javascript">npm install seneca-mongo-store</code></pre>
      

      <p>
        The data store plugins use a naming convention of the form seneca-<i>database</i>-store. The suffix <i>db</i> is dropped. Here are some of the existing data store plugins:
      </p>

      <ul>
        </li><li>JSON files (on disk) - <a href="http://github.com/rjrodger/seneca-jsonfile-store" target="_blank">seneca-jsonfile-store</a>
      </li><li>MongoDB - <a href="http://github.com/rjrodger/seneca-mongo-store" target="_blank">seneca-mongo-store</a>
      </li><li>MySQL - <a href="https://github.com/mirceaalexandru/seneca-mysql-store" target="_blank">seneca-mysql-store</a>
      </li><li>PostgreSQL - <a href="https://github.com/marianr/seneca-postgres-store" target="_blank">seneca-postgres-store</a>
      </li><li>levelDB - <a href="https://github.com/rjrodger/seneca-level-store" target="_blank">seneca-level-store</a>
      </li></ul>

      <p>
        Refer to their project pages for details on behaviour and configuration options. As a convenience, Seneca allows you to drop the <i>seneca-</i> prefix when registering the plugin:
      </p>


      
        <pre class="highlight"><code class="hljs javascript">seneca.use(<span class="hljs-string">'mongo-store'</span>,{ ... })</code></pre>
      


      <p>
        The default, built-in data store is <i>mem-store</i>, which provides a
        transient in-memory store. This is very useful for quick prototyping
        and allows you to get started quickly. By sticking to the common
        entity feature set (see below), you can easily swap over to a real database at a
        later point.
      </p>

      <p>
        If you'd like to add support for a database to Seneca,
        here's the <a href="/data-store-guide.html">guide to writing data store plugins</a>
      </p>

      <br>

      <h5>Mapping Entities to Data Stores</h5>

      <p>
        One of the most useful features of the Seneca data entity model is the
        ability to transparently use different databases. This is enabled by
        the use of Seneca actions for all the underlying operations. This
        makes it easy to pattern match against specific entity zones, bases
        and names and send them to different data stores.
      </p>

      <p>
        You can use the <i>map</i> option when registering a data store plugin
        to specify the data entity types that it should support. All others will be ignored.
      </p>

      <p>
        The map is a set of key-value pairs, where the key is an entity type
        pattern, and the value a list of entity <i>cmd</i>s
        (such as <i>save</i>,<i>load</i>,<i>list</i>,<i>remove</i>,...),
        or <code>'*'</code>, which means the mapping applies to all <i>cmd</i>s.
      </p>

      <p>
        The example mapping below means that all entities with the name <i>tmp</i>,
        regardless of zone or base, will use the transient <i>mem-store</i>:
      </p>


      
        <pre class="highlight"><code class="hljs javascript">
seneca.use(<span class="hljs-string">'mem-store'</span>,{ map:{
  <span class="hljs-string">'-/-/tmp'</span>:<span class="hljs-string">'*'</span>
}})
        </code></pre>
      


      <p>
        To use different databases for different groups of data, use the <i>base</i> element:
      </p>

      
        <pre class="highlight"><code class="hljs javascript">
seneca.use(<span class="hljs-string">'jsonfile-store'</span>,{
  folder:<span class="hljs-string">'json-data'</span>, map:{<span class="hljs-string">'-/json/-'</span>:<span class="hljs-string">'*'</span>}
})

seneca.use(<span class="hljs-string">'level-store'</span>,{
  folder:<span class="hljs-string">'level-data'</span>, map:{<span class="hljs-string">'-/level/-'</span>:<span class="hljs-string">'*'</span>}
})
        </code></pre>
      

      <p>
        This mapping sends -/json/- entities to
        the <a href="https://github.com/rjrodger/seneca-jsonfile-store" target="_blank">jsonfile</a>
        data store, and -/level/- entities to
        the <a href="https://github.com/rjrodger/seneca-level-store" target="_blank">leveldb</a>
        data store.
      </p>

      <p>
        Here it is in action:

      
        <pre class="highlight"><code class="hljs javascript">
seneca.ready(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(err,seneca)</span></span>{

  ;seneca
    .make$(<span class="hljs-string">'json'</span>,<span class="hljs-string">'foo'</span>,{propA:<span class="hljs-string">'val1'</span>,propB:<span class="hljs-string">'val2'</span>})
    .save$(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(err,json_foo)</span></span>{
      <span class="hljs-built_in">console</span>.log(<span class="hljs-string">''</span>+json_foo)

  ;seneca
    .make$(<span class="hljs-string">'level'</span>,<span class="hljs-string">'bar'</span>,{propA:<span class="hljs-string">'val3'</span>,propB:<span class="hljs-string">'val4'</span>})
    .save$(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(err,level_bar)</span></span>{
      <span class="hljs-built_in">console</span>.log(<span class="hljs-string">''</span>+level_bar)

  }) })
})
        </code></pre>
      

      <p>
        The full source code is available in the data-entities folder of the <a href="https://github.com/rjrodger/seneca-examples" target="_blank">seneca examples repository</a>.
        (The ; prefix is just a marker to avoid excessive indentation)
      </p>

      <br>
      <p>
        <b>
          Data Store Logging
        </b>
      </p>


      <p>
        You can track and debug the activity of data entities by reviewing the action log, and the plugin log for the datastore.
      </p>

      <p>
        For example, run the example above, that uses both the jsonfile store and the leveldb store, using the <code>--seneca.log=type:act</code> log filter, and you get the output:
      </p>

      
        <pre class="highlight"><code class="hljs javascript">
$ node main.js --seneca.log=type:act
...
<span class="hljs-number">2013</span>-<span class="hljs-number">04</span>-<span class="hljs-number">18</span>T10:<span class="hljs-number">05</span>:<span class="hljs-number">45.818</span>Z    DEBUG    act    jsonfile-store    BCL    wa8xc5    In    {cmd=save,role=entity,ent=$-<span class="hljs-regexp">/json/</span>foo:{id=;propA=val1;propB=val2},name=foo,base=json}    gx38qi
<span class="hljs-number">2013</span>-<span class="hljs-number">04</span>-<span class="hljs-number">18</span>T10:<span class="hljs-number">05</span>:<span class="hljs-number">45.821</span>Z    DEBUG    act    jsonfile-store    BCL    wa8xc5    OUT    [$-<span class="hljs-regexp">/json/</span>foo:{id=ulw8ew;propA=val1;propB=val2}]    gx38qi
...
<span class="hljs-number">2013</span>-<span class="hljs-number">04</span>-<span class="hljs-number">18</span>T10:<span class="hljs-number">05</span>:<span class="hljs-number">45.822</span>Z    DEBUG    act    level-store    GPN    <span class="hljs-number">8</span>dnjyt    IN    {cmd=save,role=entity,ent=$-<span class="hljs-regexp">/level/</span>bar:{id=;propA=val3;propB=val4},name=bar,base=level}    <span class="hljs-number">8</span>ml1p7
<span class="hljs-number">2013</span>-<span class="hljs-number">04</span>-<span class="hljs-number">18</span>T10:<span class="hljs-number">05</span>:<span class="hljs-number">45.826</span>Z    DEBUG    act    level-store    GPN    <span class="hljs-number">8</span>dnjyt    OUT    [$-<span class="hljs-regexp">/level/</span>bar:{id=<span class="hljs-number">7</span>de92fc0-f402-<span class="hljs-number">411</span>d-<span class="hljs-number">80</span>ea-<span class="hljs-number">59e435</span>a8c398;propA=val3;propB=val4}]    <span class="hljs-number">8</span>ml1p7
...
        </code></pre>
      

      <p>
        This shows the <i>role:entity, cmd:save</i> action of both data
        stores. Seneca actions use a JSON-in/JSON-out model. You can trace
        this using the <code>IN</code> and <code>OUT</code> markers in the log
        entries. The <code>IN</code> and <code>OUT</code> entries are connected by an action identifer, such as <i>wa8xc5</i>.
        This lets you trace actions when they interleave asynchronously.
      </p>

      <p>
        The <code>IN</code> log entries show the action arguments, including the entity data, and the entity zone, base and name (if defined).
        Once the action completes, the <code>OUT</code> log entries show the returned data. In particular, notice that the entities now have generated <i>id</i>s.
      </p>

      <p>
        The data stores themselves also generate logging output. Try <code>--seneca.log=type:plugin</code> to see this:
      </p>

      
        <pre class="highlight"><code class="hljs javascript">
$ node main.js --seneca.log=type:plugin
<span class="hljs-number">2013</span>-<span class="hljs-number">04</span>-<span class="hljs-number">18</span>T10:<span class="hljs-number">39</span>:<span class="hljs-number">54.961</span>Z    DEBUG    plugin    jsonfile-store    QSG    cop6lx    save/insert    $-<span class="hljs-regexp">/json/</span>foo:{id=nt7usm;propA=val1;propB=val2}    jsonfile-store~QSG~-<span class="hljs-regexp">/json/</span>-
<span class="hljs-number">2013</span>-<span class="hljs-number">04</span>-<span class="hljs-number">18</span>T10:<span class="hljs-number">40</span>:<span class="hljs-number">19.802</span>Z    DEBUG    plugin    level-store    JNG    save/insert    $-<span class="hljs-regexp">/level/</span>bar:{id=<span class="hljs-number">7166037e-112</span>d-<span class="hljs-number">448</span>c-<span class="hljs-number">9</span>afa-<span class="hljs-number">84e69</span>d84aa25;propA=val3;propB=val4}    level-store~JNG~-<span class="hljs-regexp">/level/</span>-
        </code></pre>
      

      <p>
        In this case, the data stores creates a log entry for each save operation that inserts data. The entity data is also shown.
        Each plugin instance gets a three letter tag, such as <code>QSG</code>, or <code>JNG</code>. This helps you distinguish between multiple mappings that use the same data store.
        Each data store plugin instance can be ths be described by the name of the data store plugin, the tag, and the associated mapping. This is the last element of the log entry. For example:
        <code>level-store~JNG~-/level/-</code>
      </p>



      <!--
      - caching
      - api coverage
        - standard data interface / common entity feature set
      - underlying actions
      - native
      - extending
      -->

      <br /><br /><br />
      <p>
        That's all folks! Corrections and comments: please tweet <a href="https://twitter.com/senecajs" target="_blank">@senecajs</a>.
      </p>

    </div>

  </div>


  <div style="clear:both;"></div>

  <div class="sep">
    <span class="star"><img src="images/star.png" alt="star" height="auto" width="20"></span>
    <span class="rule-l">&nbsp;</span>
    <span class="rule-r">&nbsp;</span>
  </div>






</div>

<!-- END OF CONTAINER -->



<footer>



	<div class="footer-one">
		<div class="col-md-12 column">


			<div class="footer-logo">
				<img src="images/logo-footer.png" alt="Seneca" title="Seneca">
			</div>




			<div class="row clearfix social">

				<div class="col-md-4 column">
					<p><a href="http://github.com/rjrodger/seneca"><i class="fa fa-github fa-2x"></i> Github</a></p>
				</div>

				<div class="col-md-4 column">
					<p><a href="http://twitter.com/nodeseneca"><i class="fa fa-twitter fa-2x"></i> Twitter</a></p>
				</div>

				<div class="col-md-4 column">
					<p><a href="http://senecajs.org/videos.html"><i class="fa fa-play-circle fa-2x"></i> Videos</a></p>
				</div>

			</div>





		</div>
	</div>



	<div class="footer-two">

		Â© Seneca 2014 All Rights Reserved.

	</div>

</footer>

<!-- FLEXSLIDER JAVASCRIPT CONTROLS -->

<script defer="defer"  src="/staging/vendor/jquery_002.js"></script><script defer="defer"  src="/staging/scripts/scripts.js"></script>

</body>
</html>