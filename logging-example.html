<html>
<head>
	<meta charset="utf-8">
	<title>Seneca, a Micro-Services toolkit for Node.js</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="description" content="">
	<meta name="author" content="">

	<link  rel="stylesheet" href="/staging/styles/bootstrap.css" />
	<link  rel="stylesheet" href="/staging/styles/font-awesome/css/font-awesome.css" />
	<link  rel="stylesheet" href="/staging/styles/style.css" />
	<link  rel="stylesheet" href="/staging/styles/flexslider.css" />

	<link  rel="stylesheet" href="/staging/styles/github.css" />

	<!-- GOOGLE WEB FONTS -->
	<link href='http://fonts.googleapis.com/css?family=Bitter:400,700,400italic' rel='stylesheet' type='text/css'>
	<link href='http://fonts.googleapis.com/css?family=Open+Sans:400,600,700,800' rel='stylesheet' type='text/css'>

	<!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
	<!--[if lt IE 9]>
	<script src="scripts/html5shiv.js"></script>
	<![endif]-->

	<!-- Fav and touch icons -->
	<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/images/apple-touch-icon-144-precomposed.png">
	<link rel="apple-touch-icon-precomposed" sizes="114x114" href="/images/apple-touch-icon-114-precomposed.png">
	<link rel="apple-touch-icon-precomposed" sizes="72x72" href="/images/apple-touch-icon-72-precomposed.png">
	<link rel="apple-touch-icon-precomposed" href="/images/apple-touch-icon-57-precomposed.png">
	<link rel="shortcut icon" href="/images/favicon.png">

	<script defer="defer"  src="/staging/vendor/jquery.js"></script><script defer="defer"  src="/staging/vendor/bootstrap.js"></script>
	<script defer="defer"  src="/staging/scripts/menu.js"></script>

</head>
<body>
<nav class="navbar navbar-default navbar-fixed-top" role="navigation">

	<div class="navbar-960">

		<!-- START TOP NAVBAR -->


		<div class="navbar-header">
			<button class="navbar-toggle" type="button" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1"> <span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button> <a class="navbar-brand" href="index.html">Seneca</a>
		</div>

		<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
			<ul class="nav navbar-nav top-nav">

				<input type="hidden" class="selected-menu-item" value="documentation" />

				<li id="index">
					<a href="index.html"><i class="fa fa-home"></i></a>
				</li>
				<li id="getting-started">
					<a href="getting-started.html" onload="">Get Started</a>
				</li>
				<li id="documentation">
					<a href="documentation.html">Documentation</a>
				</li>
				<!--<li class="dropdown">
					<a class="dropdown-toggle" href="#" data-toggle="dropdown">Dropdowns<strong class="caret"></strong></a>
					<ul class="dropdown-menu">
						<li>
							<a href="index.html">Home Page</a>
						</li>
						<li>
							<a href="content.html">Content Page</a>
						</li>
						<li>
							<a href="content-leftmenu.html">Content Page - Left Sub Menu</a>
						</li>
						<li class="divider">
						</li>
						<li>
							<a href="content.html">Content Page</a>
						</li>
						<li class="divider">
						</li>
						<li>
							<a href="content-leftmenu.html">Content Page - Left Sub Menu</a>
						</li>
					</ul>
				</li>-->
			</ul>

			<ul class="nav navbar-nav navbar-right">
				<li class="dropdown">
					<a class="dropdown-toggle" href="#" data-toggle="dropdown"><i class="fa fa-life-ring"></i> Support<strong class="caret"></strong></a>
					<ul class="dropdown-menu">
						<li>
							<a href="https://github.com/rjrodger/seneca">Source Code (GitHub)</a>
						</li>
						<li>
							<a href="https://github.com/rjrodger/seneca/issues">Bugs! Defects! Breakage!</a>
						</li>
						<li>
							<a href="https://groups.google.com/forum/#!forum/seneca-micro-services">Google Group</a>
						</li>
						<li class="divider">
						</li>
						<li>
							<a href="https://twitter.com/senecajs">@senecajs</a>
						</li>
					</ul>
				</li>
			</ul>
		</div>

	</div>

</nav>


<!-- END TOP NAVBAR -->

<div class="fullwidthtop-content">
  <div class="col-md-12 column">

    <div class="header-box">
      <h1>Seneca Logging Tutorial</h1>
    </div>

  </div>
</div>


<!-- CONTAINER STARTS HERE -->


<div class="container">


  <div class="row clearfix">
    <div class="col-md-12 column">

      <br>

      <p>
        This tutorial shows you how to control Seneca's logging
        output.  Clone the <a href="http://github.com/rjrodger/seneca">main
        Seneca repository</a> from github, and open the <i>doc/examples</i>
        folder.

      </p><p>

        You'll use the Sales Tax example code. This code shows you how to
        handle sales tax rules using Seneca. Take a look at
        the <a href="https://github.com/rjrodger/seneca">main README</a> for
        details. For this tutorial, you'll focus on the logging output.
      </p>



      <p>
        Here's some code to calculate sales tax. It won't work, because you
        haven't actually told Seneca how to do that yet.
      </p>

      
        <pre class="highlight"><code class="hljs javascript">
<span class="hljs-keyword">var</span> seneca = <span class="hljs-built_in">require</span>(<span class="hljs-string">'seneca'</span>)()

seneca.act( {cmd:<span class="hljs-string">'salestax'</span>, net:<span class="hljs-number">100</span>}, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(err,result)</span></span>{
  <span class="hljs-built_in">console</span>.log( result.total )
})
        </code></pre>
      

      <p>

        This invokes a Seneca action that, hopefully, calculates sales
        tax. Arbitrarily you're using the property <i>cmd</i> to indicate what
        you want done (calculate sales tax), and <i>net</i> is net price
        before tax. The callback function returns the total price, and uses
        the standard Node.js signature (error object as first parameter).

      </p><p>

        Let's try to run this code, even though it will fail. In the examples
        folder, this code is saved in the file <i>sales-tax-error.js</i>. Run
        this file using Node.js, and you'll see the following output:

      </p>

      
        <pre class="highlight"><code class="hljs bash">
$ node sales-tax-error.js
[-isodate-]    INFO    init    start
[-isodate-]    INFO    init    end
[-isodate-]    ERROR    fail    seneca/act_not_found
Seneca: act(args,cb):
action not found <span class="hljs-keyword">for</span> args = {<span class="hljs-string">"cmd"</span>:<span class="hljs-string">"salestax"</span>,<span class="hljs-string">"net"</span>:<span class="hljs-number">100</span>}
{ [Error: ...] }
        </code></pre>
      

      <p>
        Seneca outputs some logging information so you can track what's going
        on. The <i>INIT</i> entries log the start and end of the initialization phase, when Seneca loads plugins.
        The <i>ERROR</i> entry tells you what went wrong: no action pattern matched the input args in the JSON document:
        <code>{"cmd":"salestax","net":100}</code>. The code also prints the JavaScript Error object to the console. That's the line:
        <code>if( err ) return console.error(err);</code>
      </p>



      <p>
        You can fix this by defining an action:
      </p>

      
        <pre class="highlight"><code class="hljs javascript">
seneca.add( {cmd:<span class="hljs-string">'salestax'</span>}, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(args,callback)</span></span>{
  <span class="hljs-keyword">var</span> rate  = <span class="hljs-number">0.23</span>
  <span class="hljs-keyword">var</span> total = args.net * (<span class="hljs-number">1</span>+rate)
  callback(<span class="hljs-literal">null</span>,{total:total})
})
        </code></pre>
      

      <p>
        The file <i>sales-tax.js</i> in the examples folder contains the new code. Run it:
      </p>

      
        <pre class="highlight"><code class="hljs bash">
$ node sales-tax.js
[-isodate-]    INFO    init    start
[-isodate-]    INFO    init    end
<span class="hljs-number">123</span>
        </code></pre>
      



      <p>Well that worked! 23% sales tax on a price of $100 gives a total of $123. Fabulous!</p>

      <p>You might find that logging output annoying. Turn it off with:</p>

      
        <pre class="highlight"><code class="hljs bash">
$ node sales-tax.js --seneca.log.quiet
<span class="hljs-number">123</span>
        </code></pre>
      



      <p>Or you might be a logging freak, in which case, here's the all-you-can-eat version:</p>.



      
        <pre class="highlight"><code class="hljs bash">
node sales-tax.js --seneca.log.print
[-isodate-]    INFO    init    start
... lots of init stuff ...
[-isodate-]    INFO    init    end
[-isodate-]    INFO    add    {cmd=salestax}
[-isodate-]    DEBUG    act    <span class="hljs-keyword">in</span>    <span class="hljs-number">90</span>xkee    {cmd=salestax,net=<span class="hljs-number">100</span>}
[-isodate-]    DEBUG    act    out    <span class="hljs-number">90</span>xkee    {total=<span class="hljs-number">123</span>}
<span class="hljs-number">123</span>
        </code></pre>
      


      <p>
        So you might be wondering how to get finer-grained logging output. Logging can be filtered on:
      <ul>
        <li><i>level</i>: DEBUG, INFO, WARN, ERROR, FATAL</li>
        <li><i>type</i>: short string code, examples: init, plugin, error, ...</li>
        <li><i>plugin</i>: the names of the plugin</li>
        <li><i>tag</i>: an identifier tag, used when you have multiple instances of the same plugin</li>
      </ul>
      Let do that now:
      </p>



      
        <pre class="highlight"><code class="hljs bash">
node sales-tax.js --seneca.log=<span class="hljs-built_in">type</span>:act
[-isodate-]    DEBUG    act    <span class="hljs-keyword">in</span>    actid0    {cmd=salestax,net=<span class="hljs-number">100</span>}
[-isodate-]    DEBUG    act    out    actid0    {total=<span class="hljs-number">123</span>}
<span class="hljs-number">123</span>
        </code></pre>
      

      <p>

        The command line argument <i>--seneca.log</i> accepts a
        comma-separated list of filters. The filter <i>type:act</i> means only
        output the log entries of type <i>act</i>. The <i>type</i> is the third
        field. The <i>act</i> entries are very low level debugging logs
        showing the operation of individual actions. The logs show the input
        arguments, <i>in</i>, and the eventual output of the
        action <i>out</i>. Because these can be separated in time, a random
        action identifier (above: <i>actid0</i>) is generated for each action, so that you
        can match up the input and output.

      </p>

      <br>

      <p><b>Logging from Plugins</b></p>

      <p>
        Let's turn the sales tax calculator into a plugin. This plugin accepts
        two configuration options. You can specify the tax rate, and the
        country which applies that rate (using two letter country codes).
      </p>

      <p>
        Here's the client code, in the file <i>sales-tax-log.js</i>:
      </p>

      
        <pre class="highlight"><code class="hljs javascript">
<span class="hljs-keyword">var</span> seneca = <span class="hljs-built_in">require</span>(<span class="hljs-string">'seneca'</span>)()
seneca.use( <span class="hljs-string">'sales-tax-plugin'</span>, {country:<span class="hljs-string">'IE'</span>,rate:<span class="hljs-number">0.23</span>} )
seneca.use( <span class="hljs-string">'sales-tax-plugin'</span>, {country:<span class="hljs-string">'UK'</span>,rate:<span class="hljs-number">0.20</span>} )

seneca.act( {cmd:<span class="hljs-string">'salestax'</span>, country:<span class="hljs-string">'IE'</span>, net:<span class="hljs-number">100</span>})
seneca.act( {cmd:<span class="hljs-string">'salestax'</span>, country:<span class="hljs-string">'UK'</span>, net:<span class="hljs-number">200</span>})
seneca.act( {cmd:<span class="hljs-string">'salestax'</span>, country:<span class="hljs-string">'UK'</span>, net:<span class="hljs-number">300</span>})
        </code></pre>
      

      <p>
        Since you're using log files to trace the commands, you can drop the
        callback function from the <i>act</i> method call.
      </p>

      <p>
        Now you need a plugin - that's in the <i>sales-tax-plugin.js</i> file:
      </p>

      
        <pre class="highlight"><code class="hljs javascript">
<span class="hljs-built_in">module</span>.exports = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( seneca, options, callback )</span> </span>{

  <span class="hljs-keyword">var</span> salestax = {
    hits:<span class="hljs-number">0</span>,
    rate:options.rate,
    country:options.country
  }
  salestax.calc = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(net)</span></span>{
      <span class="hljs-keyword">return</span> net * (<span class="hljs-number">1</span>+salestax.rate)
  }

  seneca.add(
    {cmd:<span class="hljs-string">'salestax'</span>,country:salestax.country},
      <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(args,callback)</span></span>{
      <span class="hljs-keyword">var</span> total = salestax.calc(args.net)
      salestax.hits++
      seneca.log.debug(args.actid$,
                        <span class="hljs-string">'net:'</span>,args.net,
                        <span class="hljs-string">'total:'</span>,total,
                        <span class="hljs-string">'tax:'</span>,salestax)
        callback(<span class="hljs-literal">null</span>,{total:total})
    })

  callback(<span class="hljs-literal">null</span>,{name:<span class="hljs-string">'sales-tax'</span>,tag:salestax.country})
}
        </code></pre>
      

      <p>
        The plugin creates a separate instance of the <i>salestax</i> object
        for each country. This object stores the country rate, country code,
        and the number of times that sales tax for that country is calculated
        (hit count).
      </p>

      <p>
        This plugin follows the standard format for Seneca plugins. You provide a function that takes
        a Seneca instance, a set of options, and a callback. Using the Seneca instance, you add some actions, and
        finally call the callback, optionally providing some meta data:
      </p>

      
        <pre class="highlight"><code class="hljs javascript">
<span class="hljs-built_in">module</span>.exports = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( seneca, options, callback )</span> </span>{

  seneca.add( { ... }, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(args,callback)</span> </span>{
    ...
  })

  callback(<span class="hljs-literal">null</span>,{name:<span class="hljs-string">'plugin-name'</span>})
}
        </code></pre>
      

      <p>
        This initialization function is called each time you load a plugin
        with <i>seneca.use</i>. You can track separate plugin instances by
        optionally providing a tag string in the meta data:
      </p>


      
        <pre class="highlight"><code class="hljs javascript">
...
  callback(<span class="hljs-literal">null</span>,{name:<span class="hljs-string">'plugin-name'</span>,tag:<span class="hljs-string">'tag-string'</span>})
  ...
        </code></pre>
      

      <p>
        The sales tax plugin uses the country code as a tag:
      </p>

      <pre class="highlight"><code class="hljs javascript">callback(<span class="hljs-literal">null</span>,{name:<span class="hljs-string">'sales-tax'</span>,tag:salestax.country})</code></pre>

      <p>
        Run this code, and filter the log to show only debug output from the sales-tax plugin:
      </p>

      
        <pre class="highlight"><code class="hljs bash">
$ node sales-tax-log.js --seneca.log=plugin:sales-tax

[-isodate-]    DEBUG    plugin    sales-tax    IE    annv4h
net:    <span class="hljs-number">100</span>    total:    <span class="hljs-number">123</span>    tax:    {hits=<span class="hljs-number">1</span>,rate=<span class="hljs-number">0.23</span>,country=IE}

[-isodate-]    DEBUG    plugin    sales-tax    UK    <span class="hljs-number">3</span>rkaa2
net:    <span class="hljs-number">200</span>    total:    <span class="hljs-number">240</span>    tax:    {hits=<span class="hljs-number">1</span>,rate=<span class="hljs-number">0.2</span>,country=UK}

[-isodate-]    DEBUG    plugin    sales-tax    UK    cwxcts
net:    <span class="hljs-number">300</span>    total:    <span class="hljs-number">360</span>    tax:    {hits=<span class="hljs-number">2</span>,rate=<span class="hljs-number">0.2</span>,country=UK}
        </code></pre>
      


      <p>
        These logs appear because the plugin calls <i>seneca.log.debug</i> and provides the information about the sales tax calculation:
      </p>

      
        <pre class="highlight"><code class="hljs javascript">
seneca.add( {cmd:<span class="hljs-string">'salestax'</span>,country:salestax.country}, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(args,callback)</span></span>{
  <span class="hljs-keyword">var</span> total = salestax.calc(args.net)
  salestax.hits++

  seneca.log.debug(args.actid$,
                    <span class="hljs-string">'net:'</span>,args.net,
                    <span class="hljs-string">'total:'</span>,total,
                    <span class="hljs-string">'tax:'</span>,salestax)

  callback(<span class="hljs-literal">null</span>,{total:total})
})
        </code></pre>
      

      <p>
        The object <i>seneca.log</i> has convenience functions for the built-in log levels:
      <ul>
        <li>seneca.log.debug</li>
        <li>seneca.log.info</li>
        <li>seneca.log.warn</li>
        <li>seneca.log.error</li>
        <li>seneca.log.fatal</li>
      </ul>
      These functions concatenate all their arguments into an array, which is the content of the log message. This array is then
      formatted for display or storage by a handler function (which you can provide).
      To minimize impact on performance, log data is only evaluated if a
      matching log filter is active. The last argument to the logging
      function can be a function (which should return an array of values), which again is only executed if a logging
      filter matches.
      </p>

      <p>
        Here's another example. This time, you filter on the <i>act</i> log
        entry type. This allows you to see the data passing into and out of
        actions:
      </p>

      
        <pre class="highlight"><code class="hljs bash">
$ node sales-tax-log.js --seneca.log=<span class="hljs-built_in">type</span>:act
[-isodate-]    DEBUG    act    <span class="hljs-keyword">in</span>    uk74hd    {cmd=salestax,country=IE,net=<span class="hljs-number">100</span>}
[-isodate-]    DEBUG    act    out    uk74hd    {total=<span class="hljs-number">123</span>}
[-isodate-]    DEBUG    act    <span class="hljs-keyword">in</span>    qv5sts    {cmd=salestax,country=UK,net=<span class="hljs-number">200</span>}
[-isodate-]    DEBUG    act    out    qv5sts    {total=<span class="hljs-number">240</span>}
[-isodate-]    DEBUG    act    <span class="hljs-keyword">in</span>    <span class="hljs-number">7</span>j9q4a    {cmd=salestax,country=UK,net=<span class="hljs-number">300</span>}
[-isodate-]    DEBUG    act    out    <span class="hljs-number">7</span>j9q4a    {total=<span class="hljs-number">360</span>}
        </code></pre>
      

      <p>
        You can see two entries for each action, <i>in</i>
        and <i>out</i>. Each entry shows the JSON document data being passed
        into Seneca, and out of, Seneca. You can also see that each pair has the same action identifier, such as <i>uk74hd</i>.
      </p>

      <p>
        Let's put this all together. You want to see the input and output
        data of the actions, and anything the sale tax plugin decides to log:
      </p>

      
        <pre class="highlight"><code class="hljs bash">
$ node sales-tax-log.js --seneca.log=plugin:sales-tax --seneca.log=<span class="hljs-built_in">type</span>:act

[-isodate-]    DEBUG    act    <span class="hljs-keyword">in</span>    cpvycd    {cmd=salestax,country=IE,net=<span class="hljs-number">100</span>}
[-isodate-]    DEBUG    plugin    sales-tax    IE    cpvycd
net:    <span class="hljs-number">100</span>    total:    <span class="hljs-number">123</span>    tax:    {hits=<span class="hljs-number">1</span>,rate=<span class="hljs-number">0.23</span>,country=IE}
[-isodate-]    DEBUG    act    out    cpvycd    {total=<span class="hljs-number">123</span>}

[-isodate-]    DEBUG    act    <span class="hljs-keyword">in</span>    tx5zj3    {cmd=salestax,country=UK,net=<span class="hljs-number">200</span>}
[-isodate-]    DEBUG    plugin    sales-tax    UK    tx5zj3
net:    <span class="hljs-number">200</span>    total:    <span class="hljs-number">240</span>    tax:    {hits=<span class="hljs-number">1</span>,rate=<span class="hljs-number">0.2</span>,country=UK}
[-isodate-]    DEBUG    act    out    tx5zj3    {total=<span class="hljs-number">240</span>}

[-isodate-]    DEBUG    act    <span class="hljs-keyword">in</span>    <span class="hljs-number">8</span>ikumj    {cmd=salestax,country=UK,net=<span class="hljs-number">300</span>}
[-isodate-]    DEBUG    plugin    sales-tax    UK    <span class="hljs-number">8</span>ikumj
net:    <span class="hljs-number">300</span>    total:    <span class="hljs-number">360</span>    tax:    {hits=<span class="hljs-number">2</span>,rate=<span class="hljs-number">0.2</span>,country=UK}
[-isodate-]    DEBUG    act    out    <span class="hljs-number">8</span>ikumj    {total=<span class="hljs-number">360</span>}
        </code></pre>
      

      <p>
        This shows the detailed processing of the sales tax calculation. The
        action identifiers, which you can get using <i>args.actid$</i> inside
        an action function.  You need to specify two <i>--seneca.log</i>
        filters, as the type is <i>plugin</i> for one, and <i>act</i> for the
        other.
      </p>

      <p>
        The <i>tag</i> filter can be used to focus on a specific, tagged, plugin instance. Here's how you look at UK sales tax operations only:
      </p>

      
        <pre class="highlight"><code class="hljs bash">
$ node sales-tax-log.js --seneca.log=plugin:sales-tax,tag:UK
[-isodate-]    DEBUG    plugin    sales-tax    UK    i2r7wn
net:    <span class="hljs-number">200</span>    total:    <span class="hljs-number">240</span>    tax:    {hits=<span class="hljs-number">1</span>,rate=<span class="hljs-number">0.2</span>,country=UK}
[-isodate-]    DEBUG    plugin    sales-tax    UK    <span class="hljs-number">8</span>ir490
net:    <span class="hljs-number">300</span>    total:    <span class="hljs-number">360</span>    tax:    {hits=<span class="hljs-number">2</span>,rate=<span class="hljs-number">0.2</span>,country=UK}
        </code></pre>
      

      <br>

      <p><b>Live Logs in Your Browser</b></p>

      <p>
        Console logs are fun, but live logs in your web browser are awesome! Seneca can do this too:
        <img class="container-img" src="/images/seneca-admin-log.png">
      </p>

      <p>
        You'll need to create an app that provides a sales-tax calculation HTTP JSON API. Using the
        <i>transport</i> plugin this is easy. This plugin accepts JSON documents from remote clients
        over HTTP and submits them to the local Seneca instance.
      </p>

      <p>Here the code, in <i>sales-tax-app.js</i>, that sets up the app:</p>

      
        <pre class="highlight"><code class="hljs javascript">
<span class="hljs-keyword">var</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">'http'</span>)

<span class="hljs-keyword">var</span> seneca = <span class="hljs-built_in">require</span>(<span class="hljs-string">'seneca'</span>)()
seneca.use( <span class="hljs-string">'sales-tax-plugin'</span>, {country:<span class="hljs-string">'IE'</span>,rate:<span class="hljs-number">0.23</span>} )
seneca.use( <span class="hljs-string">'sales-tax-plugin'</span>, {country:<span class="hljs-string">'UK'</span>,rate:<span class="hljs-number">0.20</span>} )

seneca.use(<span class="hljs-string">'transport'</span>)

<span class="hljs-keyword">var</span> server = http.createServer(seneca.service())
server.listen(<span class="hljs-number">3000</span>)

seneca.use(<span class="hljs-string">'admin'</span>,{server:server,local:<span class="hljs-literal">true</span>})
        </code></pre>
      

      <p>
        The <i>transport</i> plugin works locally without any configuration,
        so all you have to do is load it in:
      </p>

      <pre class="highlight"><code class="hljs javascript">seneca.use(<span class="hljs-string">'transport'</span>)</code></pre>

      <p>
        The next step is to set up a simple HTTP server, using the standard
        Node.js <i>http</i> module. Any plugins that return a HTTP middleware
        function (by setting the <i>service</i> property when returning the
        plugin meta data), are wrapped up by Seneca into a single middleware
        function, returned by <i>seneca.service()</i>. You can use this as
        <a href="http://www.senchalabs.org/connect/">connect</a>
        or <a href="http://expressjs.com">express</a> middleware, or directly
        with the standard HTTP API:
      </p>

      
        <pre class="highlight"><code class="hljs javascript">
<span class="hljs-keyword">var</span> server = http.createServer(seneca.service())
server.listen(<span class="hljs-number">3000</span>)
        </code></pre>
      

      <p>
        The <i>admin</i> plugin provides a web administration interface for
        Seneca. It uses web sockets, so you need to provide a reference to the
        http server object in the plugin options.  To expose the
        admininstration web interface locally without requiring a password,
        use the <i>local:true</i> option:
      </p>

      
        <pre class="highlight"><code class="hljs javascript">seneca.use(<span class="hljs-string">'admin'</span>,{server:server,local:<span class="hljs-literal">true</span>})</code></pre>
      

      <p>
        Run this app, and open <a href="localhost:3000/admin">localhost:3000/admin</a>. You can
        still use command line logging - you can have multiple separate logging channels.
      </p>

      
        <pre class="highlight"><code class="hljs bash">$ node sales-tax-app.js --seneca.log=plugin:sales-tax</code></pre>
      


      <p>
        The administration interface let's you set filtering options. They work the same way as the command line options.
        There's nothing to log yet, so let's generate some sales tax calculations!
      </p>


      <p>
        The file <i>sales-tax-app-client.js</i> contains the client
        code. The <i>transport</i> plugin is used again on the client-side to
        direct sales tax operations to the app:
      </p>

      
        <pre class="highlight"><code class="hljs javascript">
<span class="hljs-keyword">var</span> seneca = <span class="hljs-built_in">require</span>(<span class="hljs-string">'server'</span>)()

seneca.use(<span class="hljs-string">'transport'</span>,{
  remoteurl:<span class="hljs-string">'http://localhost:3000/transport'</span>,
  pins:[ {cmd:<span class="hljs-string">'salestax'</span>} ]
})

seneca.act( {cmd:<span class="hljs-string">'salestax'</span>, country:<span class="hljs-string">'IE'</span>, net:<span class="hljs-number">100</span>})
seneca.act( {cmd:<span class="hljs-string">'salestax'</span>, country:<span class="hljs-string">'UK'</span>, net:<span class="hljs-number">200</span>})
seneca.act( {cmd:<span class="hljs-string">'salestax'</span>, country:<span class="hljs-string">'UK'</span>, net:<span class="hljs-number">300</span>})
        </code></pre>
      


      <p>

        You need to provide the <i>transport</i> plugin with some settings to
        get the sales tax operations sent over to the remote app.  First,
        provide a <i>remoteurl</i>, which is the HTTP end point of the
        transport API provided by the app. Second the <i>pins</i> setting is
        an array of action patterns.  If any of these match a submitted
        action, the action is sent over the wire to the remote app. In this
        case, anything where the <i>cmd</i> property is equal to the string
        "salestax".
      </p>

      <p>
        The sales tax operations code is as before. This is the key idea
        behind Seneca - your business logic code stays the same, but you can
        move around and reconfigure where it happens without worrying about
        refactoring your code.
      </p>

      <p>
        With the app up and running, run the client:
      </p>

      
        <pre class="highlight"><code class="hljs bash">
$ node sales-tax-log.js --seneca.log=plugin:sales-tax
[-isodate-]    DEBUG    plugin    sales-tax    IE    dy6c6k
net:    <span class="hljs-number">100</span>    total:    <span class="hljs-number">123</span>    tax:    {hits=<span class="hljs-number">1</span>,rate=<span class="hljs-number">0.23</span>,country=IE}
[-isodate-]    DEBUG    plugin    sales-tax    UK    qbfzrw
net:    <span class="hljs-number">200</span>    total:    <span class="hljs-number">240</span>    tax:    {hits=<span class="hljs-number">1</span>,rate=<span class="hljs-number">0.2</span>,country=UK}
[-isodate-]    DEBUG    plugin    sales-tax    UK    wy5uah
net:    <span class="hljs-number">300</span>    total:    <span class="hljs-number">360</span>    tax:    {hits=<span class="hljs-number">2</span>,rate=<span class="hljs-number">0.2</span>,country=UK}
        </code></pre>
      

      <p>
        You'll see corresponding log entries in the web interface, along with
        entries for the transport plugin.
      </p>

      <br>

      <p><b>Log Handlers</b></p>

      <p>
        You can define your own log handlers programmatically when you setup Seneca. The file
        <i>sales-tax-log-handler.js</i> shows you how to do this:
      </p>

      
        <pre class="highlight"><code class="hljs javascript">
<span class="hljs-keyword">var</span> seneca = <span class="hljs-built_in">require</span>(<span class="hljs-string">'seneca'</span>)

<span class="hljs-comment">// need this to get a reference to seneca.loghandler</span>
seneca = seneca({
  log:{
    map:[
      {plugin:<span class="hljs-string">'sales-tax'</span>,handler:<span class="hljs-string">'print'</span>},
      {level:<span class="hljs-string">'all'</span>,handler:seneca.loghandler.file(<span class="hljs-string">'salestax.log'</span>)}
    ]
  }
})

seneca.use( <span class="hljs-string">'sales-tax-plugin'</span>, {country:<span class="hljs-string">'IE'</span>,rate:<span class="hljs-number">0.23</span>} )
seneca.use( <span class="hljs-string">'sales-tax-plugin'</span>, {country:<span class="hljs-string">'UK'</span>,rate:<span class="hljs-number">0.20</span>} )

seneca.act( {cmd:<span class="hljs-string">'salestax'</span>, country:<span class="hljs-string">'IE'</span>, net:<span class="hljs-number">100</span>})
seneca.act( {cmd:<span class="hljs-string">'salestax'</span>, country:<span class="hljs-string">'UK'</span>, net:<span class="hljs-number">200</span>})
seneca.act( {cmd:<span class="hljs-string">'salestax'</span>, country:<span class="hljs-string">'UK'</span>, net:<span class="hljs-number">300</span>})
        </code></pre>
      

      <p>
        Running this script will output log entries both to the console (only where plugin is "sales-tax" ), and
        to a log file <i>salestax.log</i>, which gets everything. In production you mostly just want to output to the console and use
        the operating system tools for file redirection. The file handler is mostly for creating special log files.
      </p>

      <p>
        The logging map allows you to send log entries to multiple locations based on the filters you specify. You can still use the
        command line argument <i>--seneca.log=...</i> to add further filters.
      </p>

      <p>The built-in handlers are:
      <ul>
        <li><i>seneca.loghandler.print</i>: logs to the console</li>
        <li><i>seneca.loghandler.file(filepath)</i>: logs to a file</li>
        <li><i>seneca.loghandler.stream(WriteStream)</i>: logs to a stream</li>
        <li><i>seneca.loghandler.emitter(EventEmitter)</i>: logs using events</li>
      </ul>

      You can write your own handler. It's just a function that takes the
      log entry as first argument. The log entry is an array of values.
      </p>

      <p>
        Here's an example using the <a href="http://logentries.com">LogEntries.com</a> service. This is cloud logging service that
        stores your logs and makes them searchable. I wrote their Node.js API module :) - <code>$ npm install node-logentries</code>.
        This example is in the file <i>sales-tax-logentries.js</i>:
      </p>

      
        <pre class="highlight"><code class="hljs javascript">
<span class="hljs-keyword">var</span> logentries = <span class="hljs-built_in">require</span>(<span class="hljs-string">'node-logentries'</span>)

<span class="hljs-keyword">var</span> log = logentries.logger({
  token:<span class="hljs-string">'YOUR_TOKEN'</span>,

  <span class="hljs-comment">// redefine log levels to match the ones seneca uses</span>
  levels:{debug:<span class="hljs-number">0</span>,info:<span class="hljs-number">1</span>,warn:<span class="hljs-number">2</span>,error:<span class="hljs-number">3</span>,fatal:<span class="hljs-number">4</span>}
})

<span class="hljs-keyword">var</span> seneca = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../..'</span>)({
  log:{
    map:[
      {level:<span class="hljs-string">'all'</span>,handler:<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
        log.log(<span class="hljs-built_in">arguments</span>[<span class="hljs-number">1</span>],<span class="hljs-built_in">Array</span>.prototype.join.call(<span class="hljs-built_in">arguments</span>,<span class="hljs-string">'\t'</span>))
      }}
    ]
  }
})

seneca.use( <span class="hljs-string">'sales-tax-plugin'</span>, {country:<span class="hljs-string">'IE'</span>,rate:<span class="hljs-number">0.23</span>} )
seneca.use( <span class="hljs-string">'sales-tax-plugin'</span>, {country:<span class="hljs-string">'UK'</span>,rate:<span class="hljs-number">0.20</span>} )

seneca.act( {cmd:<span class="hljs-string">'salestax'</span>, country:<span class="hljs-string">'IE'</span>, net:<span class="hljs-number">100</span>})
seneca.act( {cmd:<span class="hljs-string">'salestax'</span>, country:<span class="hljs-string">'UK'</span>, net:<span class="hljs-number">200</span>})
seneca.act( {cmd:<span class="hljs-string">'salestax'</span>, country:<span class="hljs-string">'UK'</span>, net:<span class="hljs-number">300</span>})
        </code></pre>
      

      <p>
        You'll need to register a LogEntries.com account and get a token for this to work.
      </p>

      <p>
        You can use custom handler functions to send logs anywhere you want, and process them anyway you need.
      </p>

      <br>

      <p><b>One More Thing ...</b></p>


      <p>
        Log filters are dynamic. You can add new ones at runtime using the <i>seneca.logroute</i> method:
      </p>

      
        <pre class="highlight"><code class="hljs javascript">seneca.logroute( {level:<span class="hljs-string">'all'</span>, handler:seneca.handler.print} )</code></pre>
      

      <p>
        If you omit the handler, any previous filter is removed. If you add
        multiple handlers for the same filter, the logs will be sent to all
        the handlers.  This feature enables the administration web site to
        dynamically modify the filters at runtime.
      </p>


      <p>
        That's all folks! Corrections and comments: please tweet <a href="https://twitter.com/senecajs">@senecajs</a>.
      </p>
    </div>

  </div>



  <div style="clear:both;"></div>

  <div class="sep">
    <span class="star"><img src="images/star.png" alt="star" height="auto" width="20"></span>
    <span class="rule-l">&nbsp;</span>
    <span class="rule-r">&nbsp;</span>
  </div>







</div>

<!-- END OF CONTAINER -->



<footer>



	<div class="footer-one">
		<div class="col-md-12 column">


			<div class="footer-logo">
				<img src="images/logo-footer.png" alt="Seneca" title="Seneca">
			</div>




			<div class="row clearfix social">

				<div class="col-md-4 column">
					<p><a href="http://github.com/rjrodger/seneca"><i class="fa fa-github fa-2x"></i> Github</a></p>
				</div>

				<div class="col-md-4 column">
					<p><a href="http://twitter.com/nodeseneca"><i class="fa fa-twitter fa-2x"></i> Twitter</a></p>
				</div>

				<div class="col-md-4 column">
					<p><a href="http://senecajs.org/videos.html"><i class="fa fa-play-circle fa-2x"></i> Videos</a></p>
				</div>

			</div>





		</div>
	</div>



	<div class="footer-two">

		© Seneca 2014 All Rights Reserved.

	</div>

</footer>

<!-- FLEXSLIDER JAVASCRIPT CONTROLS -->

<script defer="defer"  src="/staging/vendor/jquery_002.js"></script><script defer="defer"  src="/staging/scripts/scripts.js"></script>

</body>
</html>